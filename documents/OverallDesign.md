### Bookstore 总体设计文档

#### 一、数据库设计

##### 1.需要储存的数据

​	（1）用户信息：用户编号``UserID``,用户名 ``Username``, 密码``Password``,权限 ``Privilege``。

​	（2）书本信息：书本编码``ISBN``,书名``name``,作者``author``,关键字``keywords``。

​	（3）日志信息：财务进出账&操作日志。

##### 2.储存方式

​	（1）关于文件读写：将文件读写封装为一个类，负责读/写数据，程序只从类中获取索引和数据，不直接参与文件操作。文件读写实现对一个任意类型的类的创建、读取、修改、删除，可加入缓存优化（info信息全部缓存，数据信息用一个滚动的定长数组缓存），基于文件系统的优化（卡4KB）。（注：此部分已完成）

​	（2）关于需要针对关键词进行查询的信息（用户&书本信息）：用基于文件的B+树维护数据库。维护一个线性存储所有数据的数据库，并对需要查询的关键字，维护一个关键字到数据库中信息索引的映射（B+ Tree）。每次询问/修改时，先针对给定信息，查询对应的索引，再对数据库索引的位置进行查询/修改。（注：此部分已完成）

​	（3）关于日志类信息：直接用一个文件线性存储所有的信息，在需要的时候顺序输出即可。



#### 二、功能设计

##### 1.图书系统

​	（1）功能

​		实现书本信息的创建、修改、查询；

​	（2）实现

​		创建一个数据库，并建立4个关键字到数据索引的映射。创建则对数据库和所有映射同时操作；查询/修改则针对特定关键词，利用对应映射查到对应数据的索引，并进行返回/修改。



##### 2.用户系统

​	（1）功能

​		实现用户静态信息的创建、修改、查询。

​	（2）实现

​		创建一个数据库，并建立4个关键字到数据索引的映射。创建则对数据库和所有映射同时操作；查询/修改则针对特定关键词，利用对应映射查到对应数据的索引，并进行返回/修改。



##### 3.日志系统

​	（1）功能

​		对日志信息进行记录和维护，在需要时输出。

​	（2）实现

​		从图书&用户&命令执行系统处获得信息，线性地将每一条收支/操作信息存储至文档中，并在需要时查询并输出。



##### 4.输入验证系统

​	（1）功能

​		对输入信息结构上是否合法进行验证，并提取其中的关键字信息。

​	（2）实现

​		利用C++的内置正则表达式basic_regex，建立所有操作的正则表达式信息，并在输入后直接进行匹配，利用regex自带的捕获组获取关键字信息。



##### 5.命令执行系统

​	（1）功能

​		获取输入，维护动态的操作信息（登录栈&选中的ISBN信息），并将对应任务分配给各个子系统进行运行。

​	（2）实现

​		读取信息，从输入验证系统处解析合法性和关键字，并根据命令维护登录栈，操作各个系统。~~（其实就是一坨大大的if）~~



#### 三、类、结构体设计

​	上述每一个子系统独立为一个类（输入验证除外，输入验证系统直接构造函数执行）。

​	文件读写单独封装成一个类，B+树调用文件读写类实现索引的维护。上述两个类以模板类的形式呈现，并共同构建起所有子系统的数据库部分。



#### 四、用户交互设计

```
# 退出系统
exit

# 用户系统
# 登录
login [UserID] [Password]
# 登出
logout
# 修改密码
change password [UserID] [OldPassword] [NewPassword]
# 注册账户
register [Username] [UserID] [Password]

# 图书系统
# 录入
create [ISBN] [Bookname] [Author] [Keywords] [Price]
# 查询
find (-ISBN=[ISBN] | -name=[Bookname] | -author=[Author] | -keyword=[Keyword])+
# 进货
import [ISBN] [Stock] [Cost]
# 修改
modify (-ISBN=[ISBN] | -name=[Bookname] | -author=[Author] | -keyword=[Keyword] | -price=[Price])+

# 日志系统
# 财务报表(进账&出账&all)
finance (-income | -outcome)?
# 生成日志
log
```